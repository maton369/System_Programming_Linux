#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
/*
 * stdio.h:
 *   本コードでは直接使用していないが、
 *   一般的に標準入出力関数を使う際に必要。
 *
 * stdlib.h:
 *   exit() などを使用する際に必要。
 *
 * unistd.h:
 *   execv() を使用するために必要。
 *
 * execv() は「現在のプロセスを別プログラムで完全に置き換える」
 * システムコールである。
 */

int main(){

   char command[256], *argv[32];
   /*
    * command:
    *   本コードでは未使用。
    *   通常は入力されたコマンド文字列を格納する用途で使用する。
    *
    * argv:
    *   execv() に渡す引数配列。
    *
    *   execv() の第2引数は
    *       char *argv[]
    *   形式の配列である。
    *
    *   ルール:
    *       argv[0] = 実行プログラム名
    *       argv[1..n] = 引数
    *       最後は NULL で終端
    */

   argv[0] = "/bin/ls";
   /*
    * 実行するプログラムのパス。
    *
    * execv の第1引数と argv[0] は通常同じにする。
    *
    * 実行される側から見ると、
    *   argv[0] はプログラム名として扱われる。
    */

   argv[1] = "-l";
   /*
    * プログラムに渡す第1引数。
    *
    * ここでは ls に "-l" オプションを渡している。
    *
    * 実行結果は:
    *     ls -l
    * と同じ動作になる。
    */

   argv[2] = NULL;
   /*
    * 引数配列の終端。
    *
    * execv() は NULL で終わる配列を前提としている。
    * これがないと未定義動作になる。
    */

   execv(argv[0], argv);
   /*
    * execv(path, argv)
    *
    * 第1引数:
    *   実行ファイルのパス。
    *
    * 第2引数:
    *   argv 配列。
    *
    * 成功した場合:
    *   現在のプロセスの
    *     - コード領域
    *     - スタック
    *     - ヒープ
    *     - データ領域
    *   が /bin/ls のものに完全に置き換わる。
    *
    * 重要:
    *   成功すればこの関数は戻らない。
    *
    *   PID は変わらない。
    */

   // execl(argv[0],argv[0],argv[1],NULL);
   /*
    * execl は可変長引数版。
    *
    * execv:
    *   引数を配列で渡す
    *
    * execl:
    *   引数を個別に並べて渡す
    */

   return 0;
   /*
    * execv が成功した場合、
    * ここには到達しない。
    *
    * ここに来る場合は execv が失敗している。
    */
}

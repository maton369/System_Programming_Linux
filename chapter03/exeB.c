#include <stdio.h>
#include <unistd.h>
/*
 * stdio.h:
 *   fprintf(), getchar() などの標準入出力関数を使用するために必要。
 *
 * unistd.h:
 *   execl() などの exec 系システムコールを使用するために必要。
 *
 * exec 系システムコールは、
 * 「現在のプロセスを別プログラムで置き換える」
 * ための API である。
 */

int main(void){

   fprintf(stderr,"execl実行前\n");
   /*
    * 現在のプロセス（このプログラム自身）が
    * まだ通常通り実行されていることを示す出力。
    *
    * stderr に出力しているため、
    * バッファリングの影響を受けにくい。
    */

   getchar();
   /*
    * getchar():
    *   標準入力（通常はキーボード）から 1 文字読み取る。
    *
    * ここでは「ユーザーが Enter を押すまで待つ」
    * ために使われている。
    *
    * 目的：
    *   - exec 実行前の状態を観察できるようにする
    *   - プロセスが置き換わるタイミングを意識させる
    *
    * この行があることで、
    * プロセスの流れを視覚的に理解しやすくなる。
    */

   execl("/bin/less", "less", "exeA.c", NULL);
   /*
    * execl():
    *   現在のプロセスを、指定した別プログラムで完全に置き換える。
    *
    * 引数の意味：
    *
    *   第1引数 "/bin/less"
    *     - 実行するプログラムのフルパス
    *
    *   第2引数 "less"
    *     - argv[0] として渡される文字列
    *       （慣例的にプログラム名）
    *
    *   第3引数 "exeA.c"
    *     - argv[1] として渡される引数
    *       less コマンドで表示する対象ファイル
    *
    *   最後の NULL
    *     - 引数リストの終端（必須）
    *
    * 実行後の視点（less 側）では、
    *
    *   argv[0] = "less"
    *   argv[1] = "exeA.c"
    *
    * という状態になる。
    *
    * 【最重要ポイント】
    *   execl() が成功すると、
    *   このプロセスは /bin/less に完全に置き換わる。
    *
    *   - プログラムコード
    *   - スタック
    *   - ヒープ
    *   - グローバル変数
    *
    *   すべてが新しいプログラムのものになる。
    *
    *   ただし PID は変わらない。
    *
    *   成功した場合、この関数は戻らない。
    */

   /*
    * ここに到達するのは execl() が失敗した場合のみ。
    *
    * 通常はここに来ない。
    * 実務では perror("execl") を書くのが一般的。
    */

   return 0;
   /*
    * プログラム終了。
    *
    * execl() が成功すれば、この return 0 は実行されない。
    * 実行される場合は less の起動に失敗している。
    */
}
